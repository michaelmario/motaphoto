<section class="image-container">
    <?php 
         
         
         $allphotos = new WP_Query($args);
          ?>
    <div class="w3-col display-photo">
        <?php if ($allphotos->have_posts()) :?> 
        <?php while ($allphotos->have_posts()) : $allphotos->the_post(); ?>
        

</div>
<div class="w3-col-m6">                       
                        <div class="img-box">
                            <img src="<?php echo get_field('image'); ?>" class="w3-image" alt="image de marriage">
                        </div>
                    </div>

                    <?php endwhile; wp_reset_query(); ?>
                    <button class="w3-blue-grey" id="load-more">Load More</button>
                    <?php endif; ?>
                    <?php wp_reset_postdata(); ?>
                </div>


                /******************************postphoto */

                <section class="image-container">
        <?php
        
        $allPhotos = new WP_Query($args);
       
        ?>
        <div class="display-photo">
                    <?php if ($allPhotos->have_posts()) : ?>
                    <div class="photo-grid">
                        <?php while ($allPhotos->have_posts()) : $allPhotos->the_post(); ?>
                        <div class="img-box">
                            <img src="<?php echo get_field('image'); ?>" class="w3-image" alt="image de marriage">
                            <!-- Parcourir le tableau des images -->
                        </div>
                        <?php endwhile; ?>
                    </div>
                    <button class="w3-btn w3-gray w3-margin-top" id="load-more">Load More</button>
                    <?php endif; ?>
                    <?php wp_reset_postdata(); ?>
                </div>
            </section>
               


    
</div>


function loadPhotos(filters) {
    let currentPage = 1;
    const xhr = new XMLHttpRequest();
    const loadMoreBtn = document.getElementById('load-more');
    const photoGrid = document.querySelector('.photo-grid');
     console.log(filters);

    function sendRequest() {
        let url ="http://motaphoto.local/wp-json/wp/v2/photos/";
        xhr.open('POST', 'wp-admin/admin-ajax.php');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
                const result = xhr.responseText;
                if (currentPage === 1) {
                    photoGrid.innerHTML = result;
                                                       
                } else {
                    photoGrid.insertAdjacentHTML('beforeend', result);
                }
            } else {
                console.error('Request failed. Error:', xhr.statusText);
            }
        });

        // initializing the data variable
        /*
        The action key is set to 'load_more', which is the name of the PHP function (in functions.php) 
        */
        let data = "action=load_more&paged=" + currentPage;
        // Loop that iterates over the keys in the filters object, 
        //which contains filter values for category, format, and sort.

        for (const key in filters) {

            //Appending the key-value pair to the data string in the format &key=value. 
            //This way, the data string will include all the necessary information for the server-side function 
            //to handle the filters and paginate the results correctly. It links all 3 filters together 

            data += '&' + key + '=' + filters[key]; // 'action=load_more&paged=1&category=value1&format=value2&sort=value3'
        }

        /*
    
         The dara is sent as the request payload in the AJAX request.
        */
        xhr.send(data);
    }
    

    loadMoreBtn.addEventListener('click', () => {
        currentPage = currentPage + 1;
        sendRequest();
        
    });

    sendRequest();
   
    
    return;
}


function initFilters() {
    const categoryFilter = document.getElementById('categories-select');
    const formatFilter = document.getElementById('filter-select');
    const dateFilter = document.getElementById('sort-dates');

    const filters = {
        category: '',
        format: '',
        sort: ''
    };

    function updateFiltersAndLoad() {
        filters.category = categoryFilter.value;
        filters.format = formatFilter.value;
        filters.sort = dateFilter.value;
        loadPhotos(filters);
    }

    categoryFilter.addEventListener('change', updateFiltersAndLoad);
    formatFilter.addEventListener('change', updateFiltersAndLoad);
    dateFilter.addEventListener('change', updateFiltersAndLoad);

    loadPhotos(filters);
    
}

if (document.getElementById('load-more')) {
    initFilters();
}



// ============================== Lightbox =================================== //

function openLightbox(){
    
    document.querySelectorAll('.fullscreen').forEach(open => {
         open.addEventListener('click', function () {
            const lightboxSpace = document.querySelector('.lightbox');
            
            // console.log('test-2');
            lightboxSpace.classList.add('active');

            lightboxImgSrc = this.getAttribute('rel');
            lightboxImage = document.querySelector('.image-lightbox');
            lightboxImage.src = lightboxImgSrc;
        })
    });
    const closeLightbox = document.getElementById('close-lightbox');
    closeLightbox.addEventListener('click', ()=>{
        const lightboxSpace = document.querySelector('.lightbox');
        lightboxSpace.classList.remove('active');
        
    })
}


window.addEventListener('load', (event) => {
    console.log('La page est complètement chargée');       
    // il se declance toutes les secondes
   setInterval(() => {        
        openLightbox();
      }, "1000");
  });


//====================================== Burger menu =========================//
function openBurgerMenu() {
    const openMenuIcons = document.querySelector('.burger-menu-icons');
    openMenuIcons.addEventListener('click', () => {
      const burgerMenuIcon = document.querySelector('.burger-menu-open');
      const closeIcon = document.querySelector('.burger-menu-close');
      const menu = document.querySelector('.burger-menu-opened');
  
      if (burgerMenuIcon.classList.contains('active')) {
        burgerMenuIcon.classList.remove('active');
        closeIcon.classList.add('active');
        menu.classList.add('active');
      } else {
        burgerMenuIcon.classList.add('active');
        closeIcon.classList.remove('active');
        menu.classList.remove('active');
        linkClicked();
      }
      closeIcon.addEventListener('click', ()=>{
        closeBurgerMenu();
      })

    });
  }
  openBurgerMenu();


  function linkClicked(){
    const links = document.querySelectorAll("a");
    
    for (let i = 0; i < links.length; i++) {
      links[i].addEventListener('click', () => {
        // console.log('clicked');
        closeBurgerMenu();
      });
    }
  }
  linkClicked();

  function closeBurgerMenu(){
    const burgerMenuIcon = document.querySelector('.burger-menu-open');
    const closeIcon = document.querySelector(".burger-menu-close");
    const menu = document.querySelector('.burger-menu-opened');

    burgerMenuIcon.classList.add("active");
    closeIcon.classList.remove("active");
    menu.classList.remove('active');
  }


// })(jQuery);

